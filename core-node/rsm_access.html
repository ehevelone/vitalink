<script>
const BACKEND = "https://vitalink-app.netlify.app/.netlify/functions";
const token = sessionStorage.getItem("adminSessionToken");

if (!token) {
  window.location.href = "admin.html";
}

document.querySelector(".logout").addEventListener("click", async () => {
  try {
    await fetch(`${BACKEND}/admin-logout`, {
      method: "POST",
      headers: { "x-admin-session": token }
    });
  } catch (e) {}
  sessionStorage.removeItem("adminSessionToken");
  window.location.href = "admin.html";
});

async function loadStats() {
  const res = await fetch(`${BACKEND}/admin-stats`, {
    headers: { "x-admin-session": token }
  });

  if (!res.ok) {
    sessionStorage.removeItem("adminSessionToken");
    window.location.href = "admin.html";
    return;
  }

  const data = await res.json();

  document.getElementById('totalRSMs').innerText = data.totalRSMs || 0;
  document.getElementById('totalAgents').innerText = data.totalAgents || 0;
  document.getElementById('activeAgents').innerText = data.activeAgents || 0;
  document.getElementById('totalUsers').innerText = data.totalUsers || 0;
  document.getElementById('totalProfiles').innerText = data.totalProfiles || 0;
  document.getElementById('totalScans').innerText = data.totalScans || 0;
}

loadStats();
</script>
